grade_1 <- data_sub_1 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine1,collapse = ', '),' cuisines in ',paste(input$boro1,collapse = ', ')),Grade = GRADE)
grade_2 <- data_sub_2 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine2,collapse = ', '),' cuisines in ',paste(input$boro2,collapse = ', ')),Grade = GRADE)
pie_data <- rbind(grade_1,grade_2)
pie_data$Category <- factor(pie_data$Category,levels =  unique(pie_data$Category))
pieColors <- brewer.pal(8,"Set2")[1:length(unique(pie_data$Grade))]
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1)))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(plot_bgcolor='rgb(254, 247, 234)')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(plot_bgcolor='rgb(254, 247, 234)') %>%
layout(paper_bgcolor='rgb(254, 247, 234)')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(plot_bgcolor='rgb(254, 247, 234)') %>% layout(paper_bgcolor='rgb(254, 247, 234)')
runApp()
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='rgb(254, 247, 234)'
)
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='rgb(254, 247, 234)')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#FEF7EA')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#grey')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='grey')
runApp()
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='gray15')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='grey15')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='gray')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#404040')
runApp()
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1)))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#404040',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2))
runApp()
runApp()
runApp()
?add_text(textfont = t, textposition = "top right")
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
add_text(textfont = t, textposition = "bottom left",text = 'asdf') %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
add_text(x = 0.25,y = 0.75, text = 'asdf') %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2))
?add_text
?layout
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = "YOUR TEXT HERE",  x = 200, y = 30,showarrow=FALSE ))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = "YOUR TEXT HERE",  x = 0.25, y = 1,showarrow=FALSE ))
paste(grade_1$Category[1],"                       ",grade_2$Category[1])
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = paste(grade_1$Category[1],"                       ",grade_2$Category[1]),  x = 0.5, y = 1,showarrow=FALSE )
)
sprintf("<b>%s</b>", 1:10)
sprintf("<b>%s</b>", paste(grade_1$Category[1],"                       ",grade_2$Category[1]))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],"                                    ",grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE, ))
sprintf("<b>%s</b>", paste(grade_1$Category[1],"                                    ",grade_2$Category[1]))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],"                                    ",grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],"                                                           ",grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
rep(" ",100)
paste(rep(" ",100),collapse = '')
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",100),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
?add_pie
runApp()
runApp()
runApp()
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
input <- list('cuisine1' = 'French','boro1' = 'Manhattan','cuisine2' = 'Chinese','boro2' = 'Manhattan','critFlag' = 'Y')
library(shiny)
library(DT)
library(data.table)
library(magrittr)
library(tidyverse)
library(plotly)
library(formattable)
library(RColorBrewer)
data_raw_1 <- fread('../data/Raw Data 1.csv')
data_raw_2 <- fread('../data/Raw Data 2.csv')
data_raw <- rbind(data_raw_1,data_raw_2)
##############Cleaning the raw data######################
#getting rid of data where BORO = 0
data_raw %<>% filter(`BORO` != '0')
#########################################################
vio_map <- unique(data_raw[,c('VIOLATION DESCRIPTION','VIOLATION CODE','CRITICAL FLAG')])
########filter function for convenience##################
filterByCuisineBorough <- function(dataRaw, cuisine,borough,critFlag){
if ('All' %in% cuisine){
cuisineFilter <- unique(dataRaw$`CUISINE DESCRIPTION`)
}else{
cuisineFilter <- cuisine
}
if ('All' %in% borough){
boroFilter <- unique(dataRaw$BORO)
}else{
boroFilter <- borough
}
dataRaw %>% filter(`CUISINE DESCRIPTION` %in% cuisineFilter,BORO %in% boroFilter,`CRITICAL FLAG` %in% critFlag,
`VIOLATION DESCRIPTION` != "")
}
########f################################################
input <- list('cuisine1' = 'French','boro1' = 'Manhattan','cuisine2' = 'Chinese','boro2' = 'Manhattan','critFlag' = 'Y')
data_sub <- data_raw %>% filter(!GRADE %in% c("","G")) ##filtering out empty grades and G (we do not know what G means, and it has less than 5 observations anyway)
data_sub_1 <- filterByCuisineBorough(data_sub,input$cuisine1,input$boro1,input$critFlag)
data_sub_2 <- filterByCuisineBorough(data_sub,input$cuisine2,input$boro2,input$critFlag)
##get the latest(most recent) restaurant grade for each filter
grade_1 <- data_sub_1 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine1,collapse = ', '),' cuisines in ',paste(input$boro1,collapse = ', ')),Grade = GRADE)
grade_2 <- data_sub_2 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine2,collapse = ', '),' cuisines in ',paste(input$boro2,collapse = ', ')),Grade = GRADE)
pie_data <- rbind(grade_1,grade_2)
pie_data$Category <- factor(pie_data$Category,levels =  unique(pie_data$Category))
pieColors <- brewer.pal(8,"Set2")[1:length(unique(pie_data$Grade))]
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
[1:length(unique(pie_data$Grade))]
[1:length(unique(pie_data$Grade))]
1:length(unique(pie_data$Grade))
[1:length(unique(pie_data$Grade))]
brewer.pal(8,"Set2")
pieColors <- brewer.pal(8,"Set2")[1:length(unique(pie_data$Grade))]
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
pieColors
pieColors <- brewer.pal(8,"Set2")[1:length(unique(pie_data$Grade))]
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
grade_1$Grade
grade_1$Grade <- factor(grade_1$Grade,levels = c('A','B','C','Z','P','N'))
grade_2$Grade <- factor(grade_1$Grade,levels = c('A','B','C','Z','P','N'))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
grade_1$Grade <- factor(grade_1$Grade,levels = c('A','B','C','Z','P','N'))
grade_2$Grade <- factor(grade_2$Grade,levels = c('A','B','C','Z','P','N'))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1))) %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = pieColors,line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
pieColors
grade_1$Grade
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = brewer.pal(8,"Set2"),line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
unique(pie_data$Grade)
pieColors <- brewer.pal(8,"Set3")[1:length(unique(pie_data$Grade))]
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = brewer.pal(8,"Set2"),line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = brewer.pal(8,"Set2"),line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1, Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1)))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = brewer.pal(8,"Set2"),line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1, Grade,sort = TRUE), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2, Grade,sort = TRUE), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
count(grade_1, Grade,sort = TRUE)
a <- count(grade_1, Grade,sort = TRUE)
View(a)
View(grade_1)
?count
?count
mtcars %>% count(cyl)
mtcars
a <- mtcars
View(a)
a <- mtcars
mtcars %>% count(cyl)
count(grade_1, Grade)
View(a)
dplyr::count(grade_1, Grade)
grade_1 %>% count(Grade)
data_sub <- data_raw %>% filter(!GRADE %in% c("","G")) ##filtering out empty grades and G (we do not know what G means, and it has less than 5 observations anyway)
data_sub_1 <- filterByCuisineBorough(data_sub,input$cuisine1,input$boro1,input$critFlag)
data_sub_2 <- filterByCuisineBorough(data_sub,input$cuisine2,input$boro2,input$critFlag)
##get the latest(most recent) restaurant grade for each filter
grade_1 <- data_sub_1 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine1,collapse = ', '),' cuisines in ',paste(input$boro1,collapse = ', ')),Grade = GRADE)
grade_2 <- data_sub_2 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine2,collapse = ', '),' cuisines in ',paste(input$boro2,collapse = ', ')),Grade = GRADE)
pie_data <- rbind(grade_1,grade_2)
pie_data$Category <- factor(pie_data$Category,levels =  unique(pie_data$Category))
grade_1
grade_1[,-1]
grade_1[,-1]  %>% count(Grade)
grade_1  %>% count(Grade)
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = brewer.pal(8,"Set2"),line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1[,-1], Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2[,-1], Grade,sort = TRUE), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
data_sub <- data_raw %>% filter(!GRADE %in% c("","G")) ##filtering out empty grades and G (we do not know what G means, and it has less than 5 observations anyway)
data_sub_1 <- filterByCuisineBorough(data_sub,input$cuisine1,input$boro1,input$critFlag)
data_sub_2 <- filterByCuisineBorough(data_sub,input$cuisine2,input$boro2,input$critFlag)
##get the latest(most recent) restaurant grade for each filter
grade_1 <- data_sub_1 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine1,collapse = ', '),' cuisines in ',paste(input$boro1,collapse = ', ')),Grade = GRADE)
grade_2 <- data_sub_2 %>% arrange(`CAMIS`,as.Date(`INSPECTION DATE`,'%m/%d/%Y'))%>% group_by(`CAMIS`) %>% slice(n()) %>% transmute(Category = paste0(paste(input$cuisine2,collapse = ', '),' cuisines in ',paste(input$boro2,collapse = ', ')),Grade = GRADE)
pie_data <- rbind(grade_1,grade_2)
pie_data$Category <- factor(pie_data$Category,levels =  unique(pie_data$Category))
plot_ly(textposition = 'inside',textinfo = 'label+percent',marker = list(colors = brewer.pal(8,"Set2"),line = list(color = '#FFFFFF', width = 1)),type = 'pie') %>%
add_pie(data = count(grade_1[,-1], Grade), labels = ~Grade, values = ~n,
name = grade_1$Category[1], domain = list(x = c(0, 0.5), y = c(0, 1))) %>%
add_pie(data = count(grade_2[,-1], Grade,sort = TRUE), labels = ~Grade, values = ~n,
name = grade_2$Category[1], domain = list(x = c(0.5, 1), y = c(0, 1))) %>%
layout(paper_bgcolor='#E2E2E2',legend = list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#gray",
bordercolor = "black",
borderwidth = 2),annotations = list(text = sprintf("<b>%s</b>", paste(grade_1$Category[1],paste(rep(" ",90),collapse = ''),grade_2$Category[1])),  x = 0.5, y = 1,showarrow=FALSE))
runApp()
